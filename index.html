<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="color-scheme" content="light dark">

  <!-- Je bestaande organisation-config moet geladen zijn -->
  <!-- Globale ReSpec-config -->
  <script src="./js/config.js" class="remove"></script> <!--In config.js zet je een aantal config-parameters-->

  <script>
    // javascript
    (function () {
      console.log('DIAG: location.href=', location.href);
      console.log('DIAG: location.protocol=', location.protocol, 'origin=', location.origin);
      console.log('DIAG: running under file://?', location.protocol === 'file:');
      if (navigator && navigator.serviceWorker) {
        console.log('DIAG: serviceWorker.controller=', navigator.serviceWorker.controller);
      }

      function safeLogResponse(url, res, text) {
        try {
          console.log('[DIAG FETCH OK]', url, 'status=', res.status, 'ok=', res.ok, 'headers=', Array.from(res.headers.entries()));
          console.log('[DIAG FETCH BODY]', url, text && text.slice(0, 200).replace(/\n/g, '\\n'));
        } catch (e) {
          console.error('[DIAG FETCH READ ERR]', url, e);
        }
      }

      async function tryFetch(url) {
        try {
          const res = await fetch(url, { credentials: 'same-origin' });
          const text = await res.text().catch(e => { console.error('[DIAG TEXT READ ERR]', url, e); return null; });
          safeLogResponse(url, res, text);
          if (!res.ok) console.error('[DIAG FETCH NOT OK]', url, res.status, res.statusText);
        } catch (err) {
          console.error('[DIAG FETCH ERROR]', url, err && err.name, err && err.message, err && err.stack);
        }
        // Try XMLHttpRequest to surface low-level network errors
        try {
          await new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.withCredentials = true;
            xhr.timeout = 5000;
            xhr.onload = function () {
              console.log('[DIAG XHR LOAD]', url, 'status=', this.status, 'len=', (this.responseText || '').length);
              resolve();
            };
            xhr.onerror = function (e) { console.error('[DIAG XHR ERROR]', url, e); resolve(); };
            xhr.ontimeout = function () { console.error('[DIAG XHR TIMEOUT]', url); resolve(); };
            try { xhr.send(); } catch (e) { console.error('[DIAG XHR SEND ERR]', url, e); resolve(); }
          });
        } catch (e) {
          console.error('[DIAG XHR EXCEPTION]', url, e);
        }
      }

      async function run() {
        const els = Array.from(document.querySelectorAll('[data-include]'));
        if (!els.length) {
          console.warn('DIAG: no [data-include] elements found');
          return;
        }
        for (const el of els) {
          const raw = el.getAttribute('data-include') || '';
          let resolved;
          try { resolved = new URL(raw, location.href).href; } catch (e) { resolved = raw; }
          const viaOrigin = (raw.startsWith('/') ? location.origin + raw : location.origin + '/' + raw.replace(/^\.\//,''));
          console.log('DIAG: element', el, 'raw=', raw, 'resolved=', resolved, 'viaOrigin=', viaOrigin);

          // If page is HTTPS and URL is HTTP -> Mixed Content will be blocked
          if (location.protocol === 'https:' && resolved.startsWith('http:')) {
            console.error('[DIAG MIXED CONTENT]', 'page is https but fetching http resource:', resolved);
          }

          // Try fetch with resolved URL
          await tryFetch(resolved);
          // If resolved differs from viaOrigin, try viaOrigin too
          if (viaOrigin !== resolved) await tryFetch(viaOrigin);
          // Also try raw relative (to show how server interprets it)
          const rel = raw;
          try {
            await tryFetch(rel);
          } catch (e) {}
        }
        console.log('DIAG: done running include fetch checks');
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', run);
      } else {
        run();
      }
    })();
    
  </script>
  <!-- ReSpec core -->
  <script src="https://gitdocumentatie.logius.nl/publicatie/respec/builds/respec-nlgov.js" class="remove"></script>
  <!-- Mermaid plugin (runtime) -->
  <script src="https://cdn.jsdelivr.net/gh/digitalbazaar/respec-mermaid@1.0.1/dist/main.js" class="remove"></script>

  <title>DD API V3 specificatie</title>
  <link rel="shortcut icon" type="image/svg+xml" href="./media/DigitaleDelta.svg" />
</head>

<body>
<section id="abstract" data-include-format="markdown" data-include="00-abstract.md"></section>
<section id="sotd"></section>
<section class="informative" data-include-format="markdown" data-include="01-introduction.md"></section>
<section data-include-format="markdown" data-include="02-design-concepts.md"></section>
<section data-include-format="markdown" data-include="03-usage.md"></section>
<section data-include-format="markdown" data-include="04-data-models-observation.md"></section>
<section data-include-format="markdown" data-include="05-data-models-reference.md"></section>
<section data-include-format="markdown" data-include="06-odata-subset.md"></section>
<section data-include-format="markdown" data-include="07-implementation.md"></section>
<section data-include-format="markdown" data-include="08-observations.md"></section>
<section data-include-format="markdown" data-include="09-references.md"></section>
<section class="informative" data-include-format="markdown" data-include="90-changelog.md"></section>
<section class="informative" data-include-format="markdown" data-include="98-todo.md"></section>
<section class="informative" data-include-format="markdown" data-include="99-roadmap.md"></section>
<section id='conformance'></section>
<section id='tof'></section>
<section id="index"></section>
</body>
</html>
